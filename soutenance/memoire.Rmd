---
title: "Performance comparison of the discrete choice models of consumer choice"
subtitle: "Exploration of the Econometrics and Machine Learning model performances in the presence of heterogeneous preferences and random effects utilities"
date: 28/08/2020
author: |
    | Nikita Gusarov
    | \scriptsize M2 MIASHS C2ES (UGA)
    | 
    | \raggedright\scriptsize Under supervision of: 
    | \raggedright\hspace{10mm}\scriptsize Iragaël Joly, HDR (GAEL, UGA, Grenoble INP)
    | \raggedright\hspace{10mm}\scriptsize Beatrice Roussillon, MCF (GAEL, UGA)
output: 
    beamer_presentation:
        # latex_engine: "lualatex"
        theme: "Montpellier"
        colortheme: "beaver"
        toc: FALSE
        df_print: "kable"
        slide_level: 2
        fig_width: 4.2
        fig_height: 2.5
        fig_caption: TRUE
        includes:
            in_header: auxilary/header_memoire.tex
# Fonts as recommended in guidelines
# Works only with lualatex engine
# XITS is one of the analogs for proprietary Times New Roman
fontsize: 11pt 
# mainfont: XITS 
# linestretch: 1.15 # This is standard for Word Documents (MS Word 2007, 2010, 2016)
# Add autogenerated bibentry for r packages
bibliography: 
    - ../litterature/bibliographie.bib 
    - ../litterature/packages.bib
    - ../litterature/supplementary/bibliographie.bib
biblio-style: ../article/template/ecai2012
---





# Introduction 

```{r Knitr, echo = FALSE}
#################
# Knitr options #
#################

knitr::opts_chunk$set(
    fig.align = "center",
    echo = FALSE,
    warning = FALSE
    # dev = "tikz"
)
```

```{r Packages, echo= FALSE, include = FALSE}
####################
# PAckages and AUX #
####################

# General document wide packages
library(tidyverse)
library(ggpubr)
```

## Presentation plan

- Background of the study 
- Methodology 
- Results presentation 
- Conclusion and future work

<!-- Adopter ici l'abstrait d'article (mémoire) ? -->
<!-- Confronter differents modèles avec les preference heterogènes -->

<!-- Un slide de plus ? -->
<!-- Expliquer comment c'est fait en économie et économétrie, le relier avec la phrase suivante -->
<!-- Ajouter les references  -->

## History [@hensher2015]

In economics and econometrics of the individual choice modelling the \textcolor{red}{traditional scientific procedure} includes:

1. Economics question to resolve 
2. Theoretical modelling of the underlying processus 
3. Data collection (potentially through a controlled experiment)
4. Econometrics model estimation based on the theoretical counterpart

## Scientific question of the study

*"How can we \textcolor{red}{assess and compare the performances} of different models applied to \textcolor{red}{discrete consumer choice modelling} ?"*

<!-- Supprimer le reste -->

<!-- This question arises from the work of @joly2019qcm, where different model specifications are tested. -->

This question becomes extremely complex when extended to the general comparison of *\textcolor{red}{Econometrics}* and *\textcolor{red}{Machine Learning (ML)}* models.

## Econometrics against ML [@breiman2001stat]

<!-- Si besoin du temps - supprimer le  -->

\begin{figure}[hbtp]
\centering
\label{fig:parad}
\begin{subfigure}[c]{.4\linewidth}
    \centering
    \caption{Real world}
    \label{fig:parad1}
    \begin{tikzpicture}[box/.style = {draw, text width=1.5cm, align=center}]
        \node[box] (b) {Nature};
        \node[left=of b] (a) {$\mathcal{X}$};
        \node[right=of b] (c) {$\mathcal{Y}$};
        \draw[->] (a) -- (b);
        \draw[->] (b) -- (c);
    \end{tikzpicture}
\end{subfigure}\vspace{12pt}

\begin{subfigure}[c]{.3\textwidth}
    \centering
    \caption{Econometrics}
    \label{fig:parad2}
    \begin{tikzpicture}[box/.style = {draw, text width=1.8cm, align=center}]
        \node[box] (b) {\textcolor{red}{Theoretical\\model}};
        \node[left=of b] (a) {$X$};
        \node[right=of b] (c) {$Y$};
        \draw[->] (a) -- (b);
        \draw[->] (b) -- (c);
    \end{tikzpicture}
\end{subfigure}
\hfill
\begin{subfigure}[c]{.3\linewidth}
    \centering
    \caption{Machine learning}
    \label{fig:parad3}
    \begin{tikzpicture}[box/.style = {draw, text width=1.8cm, align=center}]
        \node[box] (b) {Nature};
        \node[box, below=of b] (d) {\textcolor{red}{ML\\model}};
        \node[left=of b] (a) {$X$};
        \node[right=of b] (c) {$Y$};
        \draw[->] (a) -- (b);
        \draw[->] (b) -- (c);
        \draw[->] (a) |- (d);
        \draw[->] (d) -| (c);
    \end{tikzpicture}
\end{subfigure}
\hspace{2cm}
\end{figure} 

## Objectives

<!-- poser la question de récherche en la réliant avec le projet pour le Doctorat)  -->

<!-- Preciser encore plus  -->
<!-- Voir les question en trois blocs avant => on presente les questions (3 questions) + cela doit être conforme avec la coclusion et les résultats -->
<!-- Inserrer ici la reference à l'article de Joly ? -->

<!-- Faire un accent sur le candre de "choice experiment"  -->

Theoretical:

- *Offer a comprehensive \textcolor{red}{methodology} for consumer choice models comparison*
- *Devise a \textcolor{red}{framework}  which will allow to test hypotheses affecting modelling and model performances*
- *\textcolor{red}{Test the proposed framework} on a real world problematic* 

Applied:

- *Study the \textcolor{red}{effects of heterogeneous preferences} in population on the estimation results*

## Scientific procedure

<!-- 
- What should we understand by *performances* and how can it be measured?
- How the different models from *econometrics* and *ML* be compared?
- What are the implications and key elements for the consumer choice modelling? 
-->

<!-- Insert here a short plan with 3 questions  -->
<!-- Context, objectif, ... --> 
<!-- Accrocher à des éléments clés  -->
<!-- Consumer choice, econométrie, machine learning  -->

In this study we:

1. Propose a \textcolor{red}{theory-testing framework} 
2. Explore the different \textcolor{red}{models' performances} in the presence of \textcolor{red}{heterogeneous preferences} for attributes in population using the designed framework

Which involves:

- Construction of \textcolor{red}{two artificial datasets} controlling for the presence of \textcolor{red}{heterogeneous} and \textcolor{red}{homogeneous} preferences in population 
- Estimation of a selection of \textcolor{red}{three models}, issued from *econometrics* and *ML*, over the generated datasets 
- \textcolor{red}{Evaluation of the performances} of the models over multiple criterias

<!-- Demarche scientifique -->
<!-- Une fois qu'on a presenté le problèmatique - presenter ce qui sera fait -->





# Methodology

## Proposed framework 

<!-- Ajouter les reference ? (Eric Burel) -->
<!-- Faire attention lors de la presentation  -->
<!-- Nouveautés par rapport au textbook : simulation, estimation, performances ... -->

<!-- Question économique -> choice experiment ->  -->
<!-- Insert "choice experiment" context before this schema  -->

<!-- Faire plusieurs fleshes pour les "Datasets", remove boucle -->

<!-- article Eric Burel -> schema du framework -->

<!-- Use this schema for structure of the presentation !!! -->

<!-- \begin{figure}
    \centering
    \label{fig:burel}
    \begin{tikzpicture}[
        box/.style = {
            draw, 
            text width=2cm, 
            align=center, 
            minimum width={width("Interpretation")+2pt},
            minimum height={1cm},
            font=\small
        },node distance=1.8cm]

        \node[box] (b) {Theoretical\\model};
        \node[box, left=of b] (a) {Economic\\question};
        \node[box, right=of b] (c) {Experimental\\design};
        \node[box, below=of b] (d) {Model\\estimation};
        \node[box, below=of a] (e) {Results'\\comparison};
        \node[box, below=of c] (f) {Simulation};
        \node[box, below=of e] (ee) {Interpretation};
        %\node[below=of $(d)!0.5!(f)$] (g) {\textit{Replication}};
        
        \draw[->] (a) -- (b) node[midway, above] {\textit{Variables}};
        \draw[->] (b) -- (c) node[midway, above] {\textit{Model}};
        \draw[->] (c) -- (f);
        \draw[->] (f) -- (d) node[midway, below] {\textit{Dataset}};
        \draw[->] (d) -- (e) node[midway, below] {\textit{Results}};
        %\draw[->] (d) |- (g);
        %\draw[->] (g) -| (f);
        \draw[->] (e) -- (ee);
    \end{tikzpicture}
\end{figure} -->

\begin{figure}
    \centering
    \label{fig:burel}
    \begin{tikzpicture}[
        box/.style = {
            draw, 
            text width=2cm, 
            align=center, 
            minimum width={width("Interpretation")+2pt},
            minimum height={1cm},
            font=\small
        },node distance=1.8cm]

        \node[box] (b) {Theoretical\\model};
        \node[box, left=of b] (a) {Economic\\question};
        \node[box, right=of b] (c) {Experimental\\design};
        \node[box, below=of c] (d) {Model\\estimation};
        \node[box, below=of b] (e) {Results'\\comparison};
        \node[box, below=of a] (f) {Interpretation};

        \node[rectangle, draw=red, fit=(b) (c), inner sep=1mm, label=above:{\textcolor{red}{Simulation}}] (bc) {};
        \node[rectangle, draw=red, fit=(e) (f), inner sep=1mm, label=above:{\textcolor{red}{Comparison}}] (ef) {};
        
        \draw[->] (a) -- (b) node[midway, above] {\textit{Variables}};
        \draw[->] (b) -- (c) node[midway, above] {\textit{Model}};
        \draw[->] (c) -- (d) node[midway, left] {\textit{Dataset}};
        \draw[->] (d) -- (e) node[midway, below] {\textit{Results}};
        \draw[->] (e) -- (f) node[midway, below] {\textit{Measures}};
    \end{tikzpicture}
\end{figure}

## Consumer choice modelling [@mcfadden1974utd]

<!-- Présentation des modèles  -->

Alternatives' set, from which only one alternative may be chosen

\begin{equation}
\{\omega_1, \dots, \omega_r \} \in \Omega
\end{equation}

Utility definition incorporating fixed and random terms, with $i \in \{1, ..., N\}$ and $j \in \Omega$

\begin{equation}
U_{ij} = V_{ij} + \eta_{ij} \text{  where  } V_{ij} = f(X_i, Z_j)
\end{equation}

Random utility specification

\begin{equation}
\eta_{ij} \sim Gumble(0, 1)
\end{equation}

## Models implemented 

<!-- Be more precise in arguments -->

<!-- Pour CNN essyer d'être plus precis avec les termes - implementation déjà existante -->
<!-- Add some points about the algorithms + add the same as a possible extention for future work (in conclusion) -->

\small
\begin{table}[!htbp] \centering 
 \label{tab:comb1} 
\begin{tabular}{@{\extracolsep{5pt}}lp{70mm}} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
Model & \multicolumn{1}{c}{Characteristics} \\ 
\hline \\[-1.8ex] 
MMNL & 
    \textcolor{red}{Advanced} model used to estimate complex relationships \newline 
    \textit{Ex: random effects modelling} \\
MNL & 
    One of the most \textcolor{red}{popular} models in economics for treatment of multiple choice situations \newline 
    \textit{This leads to potential biases in many contemporary studies} \\
CNN & 
    Model with \textcolor{red}{flexible} architecture specifically adjusted for the studied case \newline 
    \textit{The computational efficiency offered by Big data techniques makes it particularly interesting} \\
\hline \\[-1.8ex] 
\end{tabular} 
\end{table} 
\normalsize

<!-- ## Econometrics: MNL and MMNL -->

<!-- Explain the differences more  -->
<!-- Speak about the algorithms implemented  -->

<!-- 1. MNL

\begin{equation}
P_{ij} = \frac{
    e^{\alpha_j + \beta_j X_i + \gamma Z_j}
}{
    \sum_{l = 1}^{k} e^{\alpha_l + \beta_l X_i + \gamma Z_l}
}
\end{equation}

2. MMNL

\begin{equation}
P_{ij} = \frac{
    e^{\alpha_j + \beta_j X_i + (\gamma + L \sigma_i) Z_j}
}{
    \sum_{l = 1}^{k} e^{\alpha_l + \beta_l X_i + (\gamma + L \sigma_i) Z_l}
} \text{  where  } LL^T = V(\gamma_i) = \Sigma
\end{equation} -->

## Traditional NN design 

\begin{figure}[htp]
\centering
\begin{tikzpicture}[
    plain/.style={
        draw = none,
        fill = none,
        font = \small
    },
    net/.style={
        matrix of nodes,
        nodes={
            draw,
            circle,
            inner sep = 5pt,
            font = \tiny
        },
        nodes in empty cells,
        column sep = 1cm,
        row sep = -5pt,
        ampersand replacement=\&
    },
    >=latex
    ]
    
\matrix[net] (mat)
{
    |[plain]| \parbox{1cm}{\centering Input\\layer} \& |[plain]| \parbox{1cm}{\centering Hidden\\layer} \& |[plain]| \parbox{1cm}{\centering Output\\layer} \\
    \& |[plain]| \\
    |[plain]| \& \\
    \& |[plain]| \\
    |[plain]| \& |[plain]| \\
    \& \& \\
    |[plain]| \& |[plain]| \\
    \& |[plain]| \\
    |[plain]| \& \\
    \& |[plain]| \\
};

\foreach \ai [count=\mi ]in {2,4,...,10}
    \draw[<-] (mat-\ai-1) -- node[above] {$X_{\mi}$} +(-1cm,0);
\foreach \ai in {2,4,...,10}
{\foreach \aii in {3,6,9}
    \draw[->] (mat-\ai-1) -- (mat-\aii-2);
}
\foreach \ai in {3,6,9}
    \draw[->] (mat-\ai-2) -- (mat-6-3);
\draw[->] (mat-6-3) -- node[above] {$Y_1$} +(1cm,0);
\end{tikzpicture}
\end{figure}

## Chosen CNN design 

<!-- ## Machine Learning: CNN -->

<!-- Add some explanations here -->

\small
\begin{figure}[!htbp] \centering 
 \label{fig:cnn} 
\small\begin{tikzpicture}[
    plain/.style={
        draw = none,
        fill = none,
        font = \small
    },
    net/.style={
        matrix of nodes,
        nodes={
            draw,
            circle,
            inner sep = 5pt,
            font = \tiny
        },
        nodes in empty cells,
        column sep = 1cm,
        row sep = -5pt,
        ampersand replacement=\&
    },
    >=latex 
]

\matrix[net] (mat)
{
    |[plain]| \parbox{0.5cm}{\centering Input\\layer} \& 
        |[plain]| \parbox{0.5cm}{\centering Convolution\\layer} \& 
        |[plain]| \parbox{0.5cm}{\centering Probability\\layer} \& 
        |[plain]| \parbox{0.5cm}{\centering Output\\layer} \\
    \& $V_A$ \& $P(A)$ \& |[plain]| \\
        |[plain]| \& |[plain]| \& |[plain]| \\
    \& $V_B$ \& $P(B)$ \& \\
        |[plain]| \& |[plain]| \& |[plain]| \\
    \& $V_C$ \& $P(C)$ \& |[plain]| \\
};


\draw[<-] (mat-2-1) -- node[above] {Rose A} +(-2cm,0);
\draw[<-] (mat-4-1) -- node[above] {Rose B} +(-2cm,0);
\draw[<-] (mat-6-1) -- node[above] {No buy (C)} +(-2cm,0);
\foreach \ai in {2,4,6}
    \draw[->] (mat-\ai-1) -- (mat-\ai-2);
\foreach \ai in {2,4,6}
    {\foreach \aii in {2,4,6}
        \draw[->] (mat-\ai-2) -- (mat-\aii-3);
    }
\foreach \ai in {2,4,6}
    \draw[->] (mat-\ai-3) -- (mat-4-4);
\draw[->] (mat-4-4) -- node[above] {Choice} +(2cm,0);

\end{tikzpicture}
\end{figure}
\normalsize

## Performance comparison 

<!-- 
* Présentation et comparaison des pérformances 
    * ajouter un tableau comparatif
    -> Analyse de performance, consentements à payer, ajustements, précision, ... 
-->

<!-- Explain the choices of the particular measures  -->
<!-- Present the performance measures  -->

- Precision in derivation of the economics values  
    * Underlying \textcolor{red}{parameters} of the utility function 
    * Case specific economic targets (WTP, Premiums, ...)
- \textcolor{red}{Overall fit} performance metrics 
    * Absolute measures (Accuracy, ...)
    * Probabilistic measures (KLD, ...)
- \textcolor{red}{Alternative-specific} performance metrics 
    * Simple measures (TPR, TNR, ...)
    * Derived measures (F-measure, Geometric means, ...)
- Technical efficiency and \textcolor{red}{ressources consumption}
    * Estimation time

## The starting point

<!-- 
Présentation de l'article de base -> Réduire cette partie au maximum, on suppose que le jury sache déjà ce qui est fait par les auteurs (il peut être interessant de le mettre après dans l'article)
    * en bref, quelques mots seulement -> Pourquoi on l'a choisi, quest-ce qui était retenu de cet article
    * ajouter un lien avec les données empiriques -> Ce qu'on peut imaginer pour l'ED  
-->

*We would like to \textcolor{red}{demonstrate} the advantages of our framework studying how \textcolor{red}{heterogeneous preferences} in population affect the results*

Using an existing application [@llerena2013rose], which incorporates all the elements of the framework: 

* Economics question - \textcolor{red}{individual preferences for environmental attributes in presence of heterogenous preferences}
* Behavioural assumptions - \textcolor{red}{random utility maximisation theory}
* Experimental design - \textcolor{red}{complex factorial design with random price allocation} 
* Advanced model implemented to model individual choices - \textcolor{red}{mixed logit}
* Economics target values - \textcolor{red}{willingness to pay for environmental attributes}

<!-- Pour nous ce sont des indicateur de performance, dans l'article se sont des valuers économique  -->

<!-- Switch palces with RUM -->

<!-- 
- @llerena2013rose
- Heterogeneous and homogeneous effects 
- Experimental design  
-->

## Utility function specification [@llerena2013rose]

Deterministic utility of the "Buy" option is

\begin{align}
V_{ij} = & \nonumber \\
    & \alpha_{i,Buy} + \nonumber \\
    & \textcolor{red}{\beta_{Buy, Sex}} Sex_i + \textcolor{red}{\beta_{Buy, Age}} Age_i + \nonumber \\
    & \textcolor{red}{\beta_{Buy, Income}} Income_i + \textcolor{red}{\beta_{Buy, Habit}} Habit_i + \\
    & \textcolor{blue}{\gamma_{Price}} Price_{ij} + \textcolor{blue}{\gamma_{i, Label}} Label_{ij} + \nonumber \\ 
    & \textcolor{blue}{\gamma_{i, Carbon}} Carbon_{ij} + \textcolor{blue}{\gamma_{i, Label \times Carbon}} Label_{ij} \times Carbon_{ij} \nonumber 
\end{align}

\scriptsize
Where $i \in \{1, \dots, N\}$, $j \in \{\text{"Buy A"}, \text{"Buy B"}, \text{"No buy"}\}$ and $Buy = I(j \in \{\text{"Buy A"}, \text{"Buy B"}\})$.
\normalsize 

<!-- Be more careful in presentation of long formulas -->

## Target values from @llerena2013rose

<!-- Remake the title - be more explicite -->

<!-- Add more precision - insert the parameter from the fuction above  -->

\scriptsize
\begin{table}[!htbp]\centering
    \label{tab:params}
\hspace{-2cm}\begin{subfigure}[l]{.3\linewidth}
    \centering
    \label{tab:params1}
\begin{tabular}[b]{@{\extracolsep{5pt}}lc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
& \multicolumn{1}{c}{\textit{Effects}} \\ 
\cline{2-2} 
\\[-1.8ex] & \multicolumn{1}{c}{\textit{Means}} \\
\hline \\[-1.8ex] 
\textbf{Individual characteristics (\textcolor{red}{$\beta$})} & \\
    ~~~Sex $\textcolor{red}{\beta_{Buy, Sex}}$ & 1.420 \\ 
    ~~~Age $\textcolor{red}{\beta_{Buy, Age}}$ & 0.009 \\ 
    ~~~Salary $\textcolor{red}{\beta_{Buy, Income}}$ & 0.057 \\ 
    ~~~Habit $\textcolor{red}{\beta_{Buy, Habit}}$ & 1.027 \\ 
\textbf{Alternatives' attributes (\textcolor{blue}{$\gamma$, $\alpha$)}} & \\
    ~~~Price $\textcolor{blue}{\gamma_{Price}}$ & $-$1.631 \\ 
    ~~~Label $\textcolor{blue}{\gamma_{i, Label}}$ & 2.824 \\ 
    ~~~Carbon $\textcolor{blue}{\gamma_{i, Carbon}}$ & 6.665 \\ 
    ~~~LC $\textcolor{blue}{\gamma_{i, Label \times Carbon}}$ & $-$2.785 \\
    ~~~Buy $\alpha_{i,Buy}$ & 2.285 \\ 
    ~~~ & \\
\hline \\[-1.8ex] 
\end{tabular} 
\end{subfigure}
\hspace{3cm}\begin{subfigure}[r]{.3\linewidth}
    \centering
    \label{tab:params2}
\begin{tabular}{@{\extracolsep{5pt}}lcc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
 & \multicolumn{2}{c}{\textit{Effects}} \\ 
\cline{2-3} 
\\[-1.8ex] & Fixed & Random \\ 
\hline \\[-1.8ex] 
\textbf{Variance} & & \\
    ~~~Buy & 0 & 3.202 \\  
    ~~~Label & 0 & 2.654 \\  
    ~~~Carbon & 0 & 3.535 \\  
    ~~~LC & 0 & 2.711 \\ 
\textbf{Covariance} & & \\ 
    ~~~Buy:Label & 0 & -0.54 \\  
    ~~~Buy:Carbon & 0 & -4.39 \\  
    ~~~Buy:LC & 0 & 6.17 \\  
    ~~~Label:Carbon & 0 & 8.77 \\  
    ~~~Label:LC & 0 & -2.33 \\  
    ~~~Carbon:LC & 0 & -4.82 \\ 
\hline \\[-1.8ex] 
\end{tabular} 
\end{subfigure}
\end{table}
\normalsize





<!-- ######################################################################## -->
<!-- ######################################################################## -->
<!-- ######################################################################## -->

# Results 

<!-- 2. Résultats -->

```{r DataManagement, include = FALSE}
load("../../data/memoire/descriptive_statistics.Rdata")
```

## Simulated datasets: Individuals

<!-- Présentation des données 
    -> montrer les résultats de simulation (comparaison des differentes jeux de données)
    -> montrer les valeurs sibles  -->

\scriptsize
```{r individuals, results = "asis"}
# Extract numbers
numbers = ind_star_data[8] %>% 
    str_extract_all(
        "\\([^()]+\\)"
    ) %>% 
    unlist() %>%
    paste(collapse = " & ")
numbers = paste0(" & ", numbers, " &  \\\\")

# Etract names 
names = ind_star_data[8] %>%
    str_remove_all(
        "\\([^()]+\\)"
    )

# Collapse
ind_star_data = c(
    ind_star_data[c(1:2, 5:7)],
    names,
    numbers,
    ind_star_data[9:length(ind_star_data)]
)

# Print
cat(
    ind_star_data,
    sep = "\n"
)
```
\normalsize

## Simulated datasets: Alternatives 

\scriptsize
```{r Alternatives, results = "asis"}
# Extract numbers
numbers = alt_star_data[8] %>% 
    str_extract_all(
        "\\([^()]+\\)"
    ) %>% 
    unlist() %>%
    paste(collapse = " & ")
numbers = paste0(" & ", numbers, " &  \\\\")

# Etract names 
names = alt_star_data[8] %>%
    str_remove_all(
        "\\([^()]+\\)"
    )

# Collapse
alt_star_data = c(
    alt_star_data[c(1:3, 5:7)],
    names,
    numbers,
    alt_star_data[c(9, 16:24, 33:length(alt_star_data))]
)

# Print
cat(
    alt_star_data,
    sep = "\n"
)
```
\normalsize

<!-- Present the datasets  -->

## Estimates of mean effects

<!-- Here explain the economics implications, interval, coefficietns, etc  -->
<!-- Dans CNN il est possible d'obtenir les IC (validation croisée avec des répetitions) -->

<!-- Ajouter des animations - couleur/gras pour les chifres dont on parle -->
<!-- Expliquer les lignes et les colonnes, puis décrire les chifres, ... -->

\tiny
\begin{table}[!htbp] \centering 
  \tiny
\begin{tabular}{@{\extracolsep{0pt}}l ccccccc } 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
 & \multicolumn{3}{c}{\textcolor{red}{\textit{Fixed effects}}} & \multicolumn{3}{c}{\textit{Random effects}} & \multicolumn{1}{c}{\textcolor{red}{\textit{Target}}} \\ 
\cline{2-4}\cline{5-7} 
\\[-1.8ex] & \multicolumn{1}{c}{\textcolor{red}{MNL}} & \multicolumn{1}{c}{\textcolor{red}{MMNL}} & \multicolumn{1}{c}{CNN} & \multicolumn{1}{c}{MNL} & \multicolumn{1}{c}{MMNL} & \multicolumn{1}{c}{CNN} & \\ 
\hline \\[-1.8ex] 
\textbf{Characteristics} & & & & & & & \\ 
    ~~~Sex & $\mathbf{1.401}^{***}$ & $1.400^{***}$ & 1.369 & $0.712^{***}$ & $1.297^{***}$ & $0.719$ & $\mathbf{1.420}$ \\ 
    & (0.031) & (0.031) & & (0.016) & (0.024) & & \\ 
    ~~~Age & $\mathbf{0.009}^{***}$ & $\mathbf{0.009}^{***}$ & 0.010 & $0.007^{***}$ & $0.010^{***}$ & $0.005$ & $\mathbf{0.009}$ \\ 
    & (0.001) & (0.001) & & (0.001) & (0.001) & & \\ 
    ~~~Salary & $0.048^{***}$ & $0.048^{***}$ & $\mathbf{0.060}$ & $0.066^{***}$ & $0.120^{***}$ & $0.062$ & $\mathbf{0.057}$ \\ 
    & (0.010) & (0.010) & & (0.005) & (0.008) & & \\ 
    ~~~Habit & $1.070^{***}$ & $1.071^{***}$ & $\mathbf{1.056}$ & $0.361^{***}$ & $0.641^{***}$ & $0.343$ & $\mathbf{1.027}$ \\ 
    & (0.030) & (0.030) & & (0.016) & (0.024) & & \\ 
\textbf{Attributes} & & & & & & & \\ 
    ~~~Price & -$1.626^{***}$ & -$\mathbf{1.628}^{***}$ & -1.618 & -$0.886^{***}$ & -$1.586^{***}$ & -$0.886$ & -$\mathbf{1.631}$ \\ 
    & (0.010) & (0.010) & & (0.006) & (0.010) & & \\ 
    ~~~Buy & $\mathbf{2.311}^{***}$ & $2.313^{***}$ & 2.228 & $0.662^{***}$ & $2.180^{***}$ & $0.665$ & $\mathbf{2.285}$ \\ 
    & (0.065) & (0.066) & & (0.036) & (0.054) & & \\ 
    ~~~Label & $2.815^{***}$ & $\mathbf{2.817}^{***}$ & 2.810 & $1.279^{***}$ & $1.922^{***}$ & $1.277$ & $\mathbf{2.824}$ \\ 
    & (0.022) & (0.022) & & (0.015) & (0.023) & & \\ 
    ~~~Carbon & $6.654^{***}$ & $\mathbf{6.662}^{***}$ & 6.634 & $3.259^{***}$ & $5.430^{***}$ & $3.250$ & $\mathbf{6.665}$ \\ 
    & (0.032) & (0.033) & & (0.016) & (0.030) & & \\ 
    ~~~LC & -$2.781^{***}$ & -$\mathbf{2.782}^{***}$ & -2.765 & -$1.546^{***}$ & -$2.663^{***}$ & -$1.558$ & -$\mathbf{2.785}$ \\ 
    & (0.028) & (0.028) & & (0.019) & (0.030) & & \\ 
\hline 
\hline \\[-1.8ex] 
\textit{Note:}  & \multicolumn{7}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\ 
\end{tabular} 
\end{table} 
\normalsize

## Estimates of mean effects

<!-- Here explain the economics implications, interval, coefficietns, etc  -->
<!-- Dans CNN il est possible d'obtenir les IC (validation croisée avec des répetitions) -->

<!-- Ajouter des animations - couleur/gras pour les chifres dont on parle -->
<!-- Expliquer les lignes et les colonnes, puis décrire les chifres, ... -->

\tiny
\begin{table}[!htbp] \centering 
  \tiny
\begin{tabular}{@{\extracolsep{0pt}}l ccccccc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
 & \multicolumn{3}{c}{\textit{Fixed effects}} & \multicolumn{3}{c}{\textcolor{red}{\textit{Random effects}}} & \multicolumn{1}{c}{\textcolor{red}{\textit{Target}}} \\ 
\cline{2-4}\cline{5-7} 
\\[-1.8ex] & \multicolumn{1}{c}{MNL} & \multicolumn{1}{c}{MMNL} & \multicolumn{1}{c}{CNN} & \multicolumn{1}{c}{\textcolor{red}{MNL}} & \multicolumn{1}{c}{MMNL} & \multicolumn{1}{c}{\textcolor{red}{CNN}} & \\ 
\hline \\[-1.8ex] 
\textbf{Characteristics} & & & & & & & \\ 
    ~~~Sex & $1.401^{***}$ & $1.400^{***}$ & 1.369 & $0.712^{***}$ & $\mathbf{1.297^{***}}$ & $0.719$ & $\mathbf{1.420}$ \\ 
    & (0.031) & (0.031) & & (0.016) & (0.024) & & \\ 
    ~~~Age & $0.009^{***}$ & $0.009^{***}$ & 0.010 & $0.007^{***}$ & $\mathbf{0.010^{***}}$ & $0.005$ & $\mathbf{0.009}$ \\ 
    & (0.001) & (0.001) & & (0.001) & (0.001) & & \\ 
    ~~~Salary & $0.048^{***}$ & $0.048^{***}$ & 0.060 & $0.066^{***}$ & $0.120^{***}$ & $\mathbf{0.062}$ & $\mathbf{0.057}$ \\ 
    & (0.010) & (0.010) & & (0.005) & (0.008) & & \\ 
    ~~~Habit & $1.070^{***}$ & $1.071^{***}$ & 1.056 & $0.361^{***}$ & $\mathbf{0.641^{***}}$ & $0.343$ & $\mathbf{1.027}$ \\ 
    & (0.030) & (0.030) & & (0.016) & (0.024) & & \\ 
\textbf{Attributes} & & & & & & & \\ 
    ~~~Price & -$1.626^{***}$ & -$1.628^{***}$ & -1.618 & -$0.886^{***}$ & -$\mathbf{1.586^{***}}$ & -$0.886$ & -$\mathbf{1.631}$ \\ 
    & (0.010) & (0.010) & & (0.006) & (0.010) & & \\ 
    ~~~Buy & $2.311^{***}$ & $2.313^{***}$ & 2.228 & $0.662^{***}$ & $\mathbf{2.180^{***}}$ & $0.665$ & $\mathbf{2.285}$ \\ 
    & (0.065) & (0.066) & & (0.036) & (0.054) & & \\ 
    ~~~Label & $2.815^{***}$ & $2.817^{***}$ & 2.810 & $1.279^{***}$ & $\mathbf{1.922^{***}}$ & $1.277$ & $\mathbf{2.824}$ \\ 
    & (0.022) & (0.022) & & (0.015) & (0.023) & & \\ 
    ~~~Carbon & $6.654^{***}$ & $6.662^{***}$ & 6.634 & $3.259^{***}$ & $\mathbf{5.430^{***}}$ & $3.250$ & $\mathbf{6.665}$ \\ 
    & (0.032) & (0.033) & & (0.016) & (0.030) & & \\ 
    ~~~LC & -$2.781^{***}$ & -$2.782^{***}$ & -2.765 & -$1.546^{***}$ & -$\mathbf{2.663^{***}}$ & -$1.558$ & -$\mathbf{2.785}$ \\ 
    & (0.028) & (0.028) & & (0.019) & (0.030) & & \\ 
\hline 
\hline \\[-1.8ex] 
\textit{Note:}  & \multicolumn{7}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\ 
\end{tabular} 
\end{table} 
\normalsize

## Case specific metrics: WTP and Premiums

<!-- Faire attention à la presentationdes écart-types -->

\tiny
\begin{table}[!htbp] \centering  
    \label{tab:wtp}  
\begin{tabular}{@{\extracolsep{5pt}} lccc >{\boldmath\bfseries}cccc >{\boldmath\bfseries}c}  
\\[-1.8ex]\hline  
\hline \\[-1.8ex]  
& \multicolumn{4}{c}{\textit{Fixed effects}} & \multicolumn{4}{c}{\textit{Random effects}} \\
\cline{2-5}\cline{6-9} 
\\[-1.8ex] & \textcolor{red}{MNL} & MMNL & CNN & \textcolor{red}{Target} & \textcolor{red}{MNL} & MMNL & CNN & \textcolor{red}{Target} \\  
\hline \\[-1.8ex]  
WTP & $1.421$ & \textbf{1.416} & $1.377$ & $1.401$ & $0.747$ & \textbf{1.360} & $0.751$ & $1.401$ \\  
    & & (0.058) & & & & (1.887) & & (1.973) \\
Label & \textbf{1.731} & 1.732 & $1.737$ & $1.731$ & \textbf{1.445} & 1.243 & $1.442$ & $1.731$ \\  
    & & (0.019) & & & & (1.667) & & (1.611) \\
Carbon & \textbf{4.091} & 4.097 & $4.101$ & $4.086$ & \textbf{3.679} & 3.467 & $3.669$ & $4.086$ \\  
    & & (0.103) & & & & (2.323) & & (2.134) \\
LC & \textbf{4.112} & 4.116 & $4.129$ & $4.110$ & \textbf{3.378} & 3.036 & $3.352$ & $4.110$ \\  
    & & (0.098) & & & & (3.240) & & (3.379) \\
\hline \\[-1.8ex]  
\end{tabular}  
\end{table}  
\normalsize

## General performance metrics 

<!-- Return only user time  -->

\scriptsize
\begin{table}[!htbp] \centering 
  \label{tab:gpm} 
\begin{tabular}{@{\extracolsep{5pt}} lcccccc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
& \multicolumn{3}{c}{\textit{Fixed effects}} & \multicolumn{3}{c}{\textit{Random effects}} \\ 
\cline{2-4}\cline{5-7} 
\\[-1.8ex] & MNL & MMNL & CNN & MNL & MMNL & CNN \\ 
\hline \\[-1.8ex] 
\multicolumn{7}{l}{\textbf{Overall measures}} \\
    ~~~Accuracy & $0.863$ & $0.863$ & $0.723$ & $0.725$ & $0.863$ & $0.721$ \\ 
\multicolumn{7}{l}{\textbf{Probabilistic measures}} \\
    ~~~KLD & $0.623$ & $0.623$ & $0.328$ & $0.349$ & $0.625$ & $0.317$ \\ 
\multicolumn{7}{l}{\textbf{CPU timings}} \\
    ~~~User & 20.910 & 452.414 & 17.433 & 18.722 & 2066.934 & 16.806 \\
\hline \\[-1.8ex] 
\end{tabular} 
\end{table} 
\normalsize

<!-- ## Single class metrics 

\scriptsize
\begin{table}[!htbp] \centering 
  \label{tab:vspm} 
\begin{tabular}{@{\extracolsep{5pt}} lcccccc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
& \multicolumn{3}{c}{\textit{Fixed effects}} & \multicolumn{3}{c}{\textit{Random effects}} \\
\cline{2-4}\cline{5-7} 
\\[-1.8ex] & C & A & B & C & A & B \\ 
\hline \\[-1.8ex] 
\multicolumn{7}{l}{\textbf{Geometric mean}} \\
    ~~~MNL & $0.454$ & $0.848$ & $0.868$ & $0.432$ & $0.696$ & $0.693$ \\
    ~~~MMNL & $0.454$ & $0.849$ & $0.867$ & $0.452$ & $0.848$ & $0.867$ \\ 
    ~~~CNN & $0.443$ & $0.697$ & $0.698$ & $0.447$ & $0.697$ & $0.700$ \\
\multicolumn{7}{l}{\textbf{F-measure}} \\
    ~~~MNL & $0.318$ & $0.834$ & $0.873$ & $0.282$ & $0.666$ & $0.704$ \\
    ~~~MMNL & $0.318$ & $0.834$ & $0.873$ & $0.316$ & $0.833$ & $0.873$ \\ 
    ~~~CNN & $0.291$ & $0.665$ & $0.706$ & $0.294$ & $0.665$ & $0.707$ \\
\hline \\[-1.8ex] 
\end{tabular} 
\end{table} 
\normalsize -->

## Positive and negative elements in modelling approaches 

<!-- Add to NN the "dark box" term -->
<!-- Être plus specifique dans ce tableau -->

<!-- Faire point par point avec l'ensemble des tabelau (ex: un tableau avec les + et -) -->

\scriptsize
\begin{table}[!htbp] \centering 
  \label{tab:gpm} 
\begin{tabular}{@{\extracolsep{5pt}} lcccccc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
& \multicolumn{3}{c}{\textit{Fixed effects}} & \multicolumn{3}{c}{\textit{Random effects}} \\ 
\cline{2-4}\cline{5-7} 
\\[-1.8ex] & MNL & MMNL & CNN & MNL & MMNL & CNN \\ 
\hline \\[-1.8ex] 
\multicolumn{7}{l}{\textbf{Utility parameters estimates}} \\
    ~~~Mean & \textcolor{blue}{+} & \textcolor{blue}{+} & \textcolor{red}{-} & \textcolor{red}{-} & \textcolor{blue}{+} & \textcolor{red}{-} \\
\multicolumn{7}{l}{\textbf{Economics metrics}} \\
    ~~~WTP & \textcolor{red}{-} & \textcolor{blue}{+} & +/- & \textcolor{red}{-} & \textcolor{blue}{+} & +/- \\  
    ~~~Label premium & \textcolor{blue}{+} & +/- & \textcolor{red}{-} & \textcolor{blue}{+} & \textcolor{red}{-} & +/- \\  
    ~~~Carbon premium & \textcolor{blue}{+} & +/- & \textcolor{red}{-} & \textcolor{blue}{+} & \textcolor{red}{-} & +/- \\  
    ~~~LC premium & \textcolor{blue}{+} & +/- & \textcolor{red}{-} & \textcolor{blue}{+} & \textcolor{red}{-} & +/- \\ 
\multicolumn{7}{l}{\textbf{Overall measures}} \\
    ~~~Accuracy & \textcolor{blue}{+} & \textcolor{blue}{+} & \textcolor{red}{-} & +/- & \textcolor{blue}{+} & \textcolor{red}{-} \\ 
\multicolumn{7}{l}{\textbf{Probabilistic measures}} \\
    ~~~KLD & \textcolor{blue}{+} & \textcolor{blue}{+} & \textcolor{red}{-} & +/- & \textcolor{blue}{+} & \textcolor{red}{-} \\ 
\multicolumn{7}{l}{\textbf{CPU timings}} \\
    ~~~User & +/- & \textcolor{red}{-} & \textcolor{blue}{+} & +/- & \textcolor{red}{-} & \textcolor{blue}{+} \\
\hline \\[-1.8ex] 
\end{tabular} 
\end{table} 
\normalsize

<!-- Refaire -->





<!-- ######################################################################## -->
<!-- ######################################################################## -->
<!-- ######################################################################## -->

# Conclusion

<!-- 
3. Conclusion: test de 3 modèles, outil de simulation fonctionnel, test des hypothèses, à quoi ça sert -> point experimentalist, point économétrique, point méthode scientifique
    
-> Modifer la structure: reprendre la structure de l'article. 
Cela doit être sinthétique. 

-> Revenir sur la présentation économique

-> Rélier un peu avec le doctorat 
-->

## Obtained results 

1. Theoretical:

- We have proposed an integrated \textcolor{red}{theory-testing framework} 
- \textcolor{red}{Data simulation tool} was created

<!-- Fait un benchmark -->

2. Applied 

- We have simulated the research procedure under different individual preferences specifications
- \textcolor{red}{Three different models} issued from different fields have been tested
    * Econometrics: MNL and MMNL 
    * Machine Learning: CNN representation of MNL 
- The application \textcolor{red}{analysed the differences} in performances of the models in various choice contexts

<!-- ## Models analysis 

\small
\begin{table}[!htbp] \centering 
 \label{tab:comb1} 
\begin{tabular}{@{\extracolsep{5pt}}lp{40mm}p{40mm}} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
Model & \multicolumn{1}{c}{Positive} & \multicolumn{1}{c}{Negative} \\ 
\hline \\[-1.8ex] 
MNL & 
    Easy to understand \newline Easy to implement \newline Most popular technique & 
    Produces correct results only if all the hypothesis are verified \\
MMNL & 
    More forgiving method \newline Accounts for tastes' heterogeneity &  
    Inefficient in computation \newline Requires more data \newline Not perfect estimates for variance \\
CNN & 
    Identical performances to MNL \newline May be fine-tuned \newline Resources efficient & 
    Produces correct results only if all the hypothesis are verified \\
\hline \\[-1.8ex] 
\end{tabular} 
\end{table} 
\normalsize -->

## Implications and future work

For \textcolor{red}{experimental economics}

* Possibility to test experimental designs 
    - *size of population to involve*
    - *the number of choice sets to consider*
* Possibility to observe how the decision rules affect estimation results 
    - *Random Regret Minimisation* 
    - *Random Utility Maximisation*
    - *Quantum Decision Theory*
* Possibility to explore and choose models before study

## Implications and future work

For \textcolor{red}{econometrics} 

* Possibility to compare models issued from different disciplines 
    - *a further extended study of the ML techniques adoptation for economics*
    - *comparison of the advanced econometrics techniques*
* Possibility to observe how different models perform in different environments 
    - *in field experiments* 
    - *over the simulated data*

## Implications and future work

For the \textcolor{red}{methodology of research} in social sciences

* A hypothesis-testing framework has been proposed (*it may be interesting to adjust the framework for other social science domains*)

<!-- ## Future work  -->
<!-- Merge these two slides -->

<!-- - Study the models' behaviour under \textcolor{red}{different decision rules}
    * Random Regret Minimisation (RRM)
    * Quantum Decision Theory (QDT)
- Explore further the implementations of econometrics and machine learning techniques in \textcolor{red}{consumer decisions modelling}
- Observe how different \textcolor{red}{experimental designs} affect the estimation results 
- Verify the frameworks' validity through \textcolor{red}{experimental study} on field datasets -->

## References 

\scriptsize
<div id="refs"></div>
\normalsize

## Credits 

- This work was fulfilled with financial support of MIAI interdisciplinary institude, under supervision of Sihem Amer-Yahia, the head of SLIDE team at LIG laboratory. 

- Honors for the simulation tool implementation go to Amirreza Talebijamalabad, who worked under the supervision of Iragaël Joly and myself. 

- The fulfillment of this work was possible thanks to the technical and administrative support from the GAEL and LIG laboratories.

<!-- Ajouter un slide pour les remerciements -->
<!-- Ajouter ici Amirreza, parler du COVID (cela à l'oral) + financement -->

<!-- Ajouter un annex avec "ce qui j'ai appris pendant ce stage" -->

<!-- Verifier le temps => 20 minutes --> 

# Thank you for your attention

# Annexes 

## Simulator robustness exploration

<!-- Mettre cela dans les annexes -->
<!-- ANNEXES -->

<!-- ajouter ici les extention et les bencmarks -> Ajouter cette partie dans les extensions? (après les résultats et avant l'ouverture) + rélier cela avec doctorat -->

```{r TotalUt}
# Load dataset with bench
load("../../data/memoire/stat_novar.Rdata")
load("../../data/memoire/stat_covar.Rdata")

# Plot dataset
plot_stat = function(
    data = statistics, 
    type = "mean",
    variable = NULL) {
    data %>% 
    mutate(
        Type = as.factor(Type)
    ) %>% 
    dplyr::filter(
        Type == "mean",
        Alternative != "C"
    ) %>% 
    group_by(Individuals, Replications) %>%
    summarize_all(mean) %>% 
    ggplot(
        aes(
            y = !!sym(variable), 
            x = Individuals,
            col = Replications
        )) +
        stat_summary(
            geom = "ribbon", 
            fun.data = mean_sdl, 
            fill = "lightgrey"
        ) +
        stat_summary(
            geom = "line", 
            fun = mean, 
            linetype = "dashed"
        ) +
        geom_point(
            size = 0.2
        ) + 
        scale_color_gradient(
            low = "green", 
            high = "red"
        ) +
    theme_classic(base_size = 8)
}

# Alt Ut 
p_tu_novar = plot_stat(stat_novar, "mean", "TU") + ggtitle("Fixed effects")
p_tu_covar = plot_stat(stat_covar, "mean", "TU") + ggtitle("Random effects")

# Arrange 
ggarrange(
    p_tu_novar, p_tu_covar, 
    ncol = 2,
    common.legend = TRUE, 
    legend = "bottom",
    align = "h"
)
```







<!-- 
Le plan de la présentation (plun + brouillon maintenant), se trouve ici: https://github.com/nikitagusarov/performance_comparison/blob/master/presentations/memoire/memoire.pdf 

-> Les enjeux: tester la prés pour 
-> Montrer que la procedure scientifique est maitrisée, montrer qu'on à pris en compte tous les éléments

Le plan abbrégé, l'idée principale - "suivre la strucutre du mémoire" (peut-être c'est pas la meilleure stratégie?) -> Modifier pour la rendre plus simple: 

0. Introduction 
    * Imaginer d'ou viens cet étude -> ex: idée de comparer les NN avec MMNL
    
1. Partie méthodologique
    * introudir les enjeux, difficultés -> ce qu'on a besoin de faire
    * poser la question de récherche en la réliant avec le projet pour le Doctorat) 
    * article Eric Burel -> schema du framework
    * Présentation de l'article de base -> Réduire cette partie au maximum, on suppose que le jury sache déjà ce qui est fait par les auteurs (il peut être interessant de le mettre après l'article)
       * en bref, quelques mots seulement -> Pourquoi on l'a choisi, quest-ce qui était retenu de cet article
       * ajouter un lien avec les données empiriques -> Ce qu'on peut imaginer pour l'ED 
   * Présentation des modèles 
       * Ajouter un schema (tableau) avec les supposition *ex ante* (ou un liste) -> NN sera plus efficace en termes de l'algorithme, mais la procedure choisie biasie les résultats 
       * -> rappels des ratio, l'utilité aléatoire, fonctions de distribution + économie 
       * un modèle de plus? ça ne sera pas trop lourd? (il y a déjà une extention des CNN avec des utilités mixtes) -> Mentionner les perspectives
       
2. Résultats
   * Présentation des données 
       * ajouter ici les extention et les bencmarks -> Ajouter cette partie dans les extensions? (après les résultats et avant l'ouverture) + rélier cela avec doctorat
       -> montrer les résultats de simulation (comparaison des differentes jeux de données)
       -> montrer les valeurs sibles 

   * Présentation et comparaison des pérformances 
       * ajouter un tableau comparatif
       -> Analyse de performance, consentements à payer, ajustements, précision, ...
    
3. Conclusion: test de 3 modèles, outil de simulation fonctionnel, test des hypothèses, à quoi ça sert -> point experimentalist, point économétrique, point méthode scientifique
    
-> Modifer la structure: reprendre la structure de l'article. 
Cela doit être sinthétique. 

-> Revenir sur la présentation économique

-> Rélier un peu avec le doctorat

Un plan altérnative - "faire focs sur la problèmatique + les extensions" (l'idée de la soutenance est d'aporter quelque chose de plus par rapport au text principal)

Questions: 

- Langue à choisir pour cette présentation? 
- Priorités pour cette présentation? 
Il faut apporter queque chose neuf par rapport au mémoire.  
-->